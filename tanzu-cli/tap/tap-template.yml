#@ load("@ytt:data", "data")

#@ view_agent = "eks."+ data.values.clusters.view.credName + "." + data.values.clusters.view.region + "." + data.values.clusters.view.name

fullName:
  name: #@ data.values.tap.name
spec:
  clusterPackageData:
  - clusterFullName:
      managementClusterName: eks
      name: #@ view_agent
      provisionerName: eks
      orgId: #@ data.values.orgId
    inlineValues:
      package_overlays:
      - name: cert-manager
        secrets:
          - name: cert-man-sa-arn
      excluded_packages:
      - fluxcd.source.controller.tanzu.vmware.com
      appliveview:
        ingressEnabled: true
      ceip_policy_disclosed: true
      deployed_through_tmc: true
      metadata_store:
        ingress_issuer: tap-ingress-selfsigned
        ns_for_export_app_cert: '*'
      profile: view
      shared:
        ingress_domain: #@ data.values.tap.profiles.view.ingress_domain
        ingress_issuer: #@ data.values.tap.profiles.view.ingress_issuer
      tap_gui:
        app_config:
          auth:
            allowGuestAccess: true
      tap_telemetry:
        customer_entitlement_account_number: ""
    packageRef:
      packageMetadataName: tap.tanzu.vmware.com
      versionSelection:
        constraints: #@ data.values.tap.version
    tapProfile: view
  #! - clusterFullName:
  #!     managementClusterName: costco-poc
  #!     name: tap-build
  #!     provisionerName: lab
  #!   inlineValues:
  #!     ceip_policy_disclosed: true
  #!     deployed_through_tmc: true
  #!     excluded_packages:
  #!     - fluxcd.source.controller.tanzu.vmware.com
  #!     grype:
  #!       metadataStore:
  #!         authSecret:
  #!           importFromNamespace: metadata-store-secrets
  #!           name: store-auth-token
  #!         caSecret:
  #!           importFromNamespace: metadata-store-secrets
  #!           name: store-ca-cert
  #!         url: https://metadata-store.tap-view.ct-tap.azure.warroyo.com
  #!     namespace_provisioner:
  #!       additional_sources:
  #!       - git:
  #!           ref: origin/main
  #!           subPath: ns-provisioner/clusters/tap-build/config
  #!           url: https://github.com/warroyo/tmc-tap
  #!         path: _ytt_lib/testing-scanning-supplychain-parameterized-setup
  #!       controller: false
  #!       default_parameters:
  #!         supply_chain_service_account:
  #!           secrets:
  #!           - github-warroyo-secret
  #!       gitops_install:
  #!         ref: origin/main
  #!         subPath: ns-provisioner/clusters/tap-build/namespaces
  #!         url: https://github.com/warroyo/tmc-tap
  #!     ootb_supply_chain_testing_scanning:
  #!       gitops:
  #!         commit_strategy: pull_request
  #!         pull_request:
  #!           commit_branch: ""
  #!           pull_request_body: generated by supply chain
  #!           pull_request_title: ready for review
  #!           server_kind: github
  #!         repository_name: tmc-tap
  #!         repository_owner: warroyo
  #!         server_address: https://github.com/
  #!         ssh_secret: github-warroyo-secret
  #!     profile: build
  #!     shared:
  #!       image_registry:
  #!         project_path: dev.registry.tanzu.vmware.com/warroyo
  #!         secret:
  #!           name: dev-tanzu-registry
  #!           namespace: default
  #!     supply_chain: testing_scanning
  #!     tap_telemetry:
  #!       customer_entitlement_account_number: ""
  #!   packageRef:
  #!     packageMetadataName: tap.tanzu.vmware.com
  #!     versionSelection:
  #!       constraints: 1.7.0
  #!   tapProfile: build
  #! - clusterFullName:
  #!     managementClusterName: costco-poc
  #!     name: tap-run
  #!     provisionerName: lab
  #!   inlineValues:
  #!     ceip_policy_disclosed: true
  #!     deployed_through_tmc: true
  #!     excluded_packages:
  #!     - fluxcd.source.controller.tanzu.vmware.com
  #!     namespace_provisioner:
  #!       additional_sources:
  #!       - git:
  #!           ref: origin/main
  #!           subPath: ns-provisioner/clusters/tap-run/config
  #!           url: https://github.com/warroyo/tmc-tap
  #!       controller: false
  #!       default_parameters:
  #!         supply_chain_service_account:
  #!           secrets:
  #!           - github-warroyo-secret
  #!       gitops_install:
  #!         ref: origin/main
  #!         subPath: ns-provisioner/clusters/tap-run/namespaces
  #!         url: https://github.com/warroyo/tmc-tap
  #!     package_overlays:
  #!     - name: cert-manager
  #!       secrets:
  #!       - name: cert-man-recursive-ns
  #!     profile: run
  #!     shared:
  #!       ingress_domain: onprem.ct-tap.azure.warroyo.com
  #!       ingress_issuer: letsencrypt-prod
  #!     tap_telemetry:
  #!       customer_entitlement_account_number: ""
  #!   packageRef:
  #!     packageMetadataName: tap.tanzu.vmware.com
  #!     versionSelection:
  #!       constraints: 1.7.0
  #!   tapProfile: run  
type:
  kind: Solution
  package: vmware.tanzu.manage.v1alpha1.tanzupackage.tap.solution
  version: v1alpha1

